window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.core.lyncintegration.js'] = (new Date()).getTime();
Type.registerNamespace("_lwx");_lwx.j=function(n){this.b=Function.createDelegate(this,this.d);_lwx.j.initializeBase(this);this.a=n;this.a.apcl(_a.bp.b,this.b)};_lwx.j.prototype={a:null,c:null,lastUserActivityTime:function(){return this.c},eJ:function(){this.a.rpcl(_a.bp.b,this.b);_a.gb.prototype.eJ.call(this)},d:function(n,t){this.c=this.a.a}};_lwx.i=function(n){this.gg=Function.createDelegate(this,this.hc);this.ge=Function.createDelegate(this,this.ha);this.gd=Function.createDelegate(this,this.gZ);this.gf=Function.createDelegate(this,this.hb);_lwx.i.initializeBase(this,[null,!0,null]);this.dx=n;this.bJ()};_lwx.i.prototype={dx:null,fn:!1,gk:function(){return this.dx?this.dx.a.b.c():null},gl:function(){return this.dx?this.dx.a.c.c():null},fE:function(n,t){return this.dx?this.dx.a.a.c():null},hd:function(){if(!this.fn&&this.dx){this.dx.b.a(this.gf);this.dx.a.a.a(this.gd);this.dx.a.b.a(this.ge);this.dx.a.c.a(this.gg);this.fn=!0}},he:function(){if(this.fn&&this.dx){this.dx.b.d(this.gf);this.dx.a.a.d(this.gd);this.dx.a.b.d(this.ge);this.dx.a.c.d(this.gg);this.fn=!1}},ha:function(n){this.eH("DisplayName")},gZ:function(n){this.eH("PhotoUrl")},hc:function(n){this.bJ();this.eH("ImAddress")},hb:function(n){this.dH?this.dH.b(_lwx.c.a(n)):_a.z.a.a(new _a.br(1,"SkypePersona_NoPresenceObserverSet"))}};_lwx.a=function(n,t,i,r){_lwx.a.initializeBase(this,[n,i.L.a().k().SkypeScriptsUrl,_lwx.a.c(t,i,r)])};_lwx.a.c=function(n,t,i){var r=_o365sg2p.e.i(i.a());r.a=n;r.c=t.bc;i.a().WorkloadId||(r.h="OwaWorkloadId");i.a().UID||(r.g=_j.h.e(i.a().UPN).toString());i.a().SHSID||(r.e=_lwx.a.b());i.b().CorrelationID||(r.f=_a.d.get_utcNow().h().toString());i.a().SkypeApiKey||(r.b=(n&1)==1?t.L.a().k().SkypeConsumerApiKey:t.L.a().k().SkypeEnterpriseApiKey);return r};_lwx.a.a=function(){return Math.floor((1+Math.random())*65536).toString(16).substr(1)};_lwx.a.b=function(){return _lwx.a.a()+_lwx.a.a()+"-"+_lwx.a.a()+"-"+_lwx.a.a()+"-"+_lwx.a.a()+"-"+_lwx.a.a()+_lwx.a.a()+_lwx.a.a()};_lwx.e=function(n){this.j=n};_lwx.e.prototype={j:null,c:function(n,t){return new _lwx.d(this.j,n,t,null,1)},b:function(n,t){return this.k(n,t,1)},g:function(n,t){return this.k(n,t,2)},h:function(n,t){return this.k(n,t,3)},i:function(n,t){return null},f:function(n){return null},k:function(n,t,i){var r=new _j.l;r.a(n);return new _lwx.d(this.j,r,null,t,i)}};_lwx.d=function(n,t,i,r,u){_lwx.d.initializeBase(this);_a.b.a(t,"participants");_a.b.g(t.x.length,0,"participants.Count");if(r){if(t.x.length!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(i)throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.j=n;this.d=_lwx.d.a(n,t);_a.b.g(this.d.x.length,0,"No valid participants.");this.k=i;this.e=r;this.f=u;var f=this;_sk.a.a(function(n){f.h=n})};_lwx.d.a=function(n,t){for(var u=new _j.l,f={},r=0;r<t.x.length;r++){var i=t.x[r];if(i&&n.a(i.i())){var e=i.i();if(!(e in f)){u.a(i);f[e]=i}}}return u};_lwx.d.prototype={j:null,d:null,k:null,e:null,h:null,f:0,S:function(){_a.dk.prototype.S.call(this);if(this.d.x.length>0){_j.e.a(_ff.c.j,"Starting chat with "+this.d.x.length+" and first is "+this.e);for(var t=new Array(this.d.x.length),n=0;n<this.d.x.length;n++)t[n]=this.e||this.d.x[n].i();this.h.t(t,[this.f])}},ba:function(){return 0}};_lwx.b=function(n,t,i,r,u){this.S=Function.createDelegate(this,this.bg);this.P=Function.createDelegate(this,this.ba);this.U=Function.createDelegate(this,this.bi);this.V=Function.createDelegate(this,this.bj);this.Q=Function.createDelegate(this,this.be);this.R=Function.createDelegate(this,this.bf);this.T=Function.createDelegate(this,this.bh);this.W=Function.createDelegate(this,this.bk);this.E=new _j.l;this.Y=new _j.l;this.D={};this.H={};this.bm={};_lwx.b.initializeBase(this);_j.e.a(_a.a.de,"LyncIntegrationChatManager started");if(!n){this.n("Initialization","Disabled");return}this.n("Initialization","unknown");this.J=u;this.G=!1;if(i){this.K=i;this.N=!0;r?this.bb(r):this.B="Disabled";this.K.b(_db.cu,this.W)}_sk.a.a(this.T)};_lwx.b.prototype={N:!1,Z:null,M:null,L:!1,B:"unknown",G:!1,C:null,J:null,K:null,d:function(){return this.B},c:function(){return this.B==="SignedIn"},f:function(){this.X("IsEnabled");return this.B!=="Disabled"},s:function(){return this.E},r:function(){return this.Y},t:function(){return!this.J.c()},b:function(){this.X("CurrentUserSipUri");return this.M},k:function(n){this.G=n;if(n){var t=this,i=this;_o365sg2p.e.b(!0,function(){},function(n){_j.e.c(_a.a.l,"ChatManager: Failed to set Skype auto-signin preference: {0}",n.message)})}this.n("SignIn","AttemptingSignIn");this.bd()},l:function(n){_j.e.a(_a.a.l,"Signing out.");this.n("SignOut:Manual="+n,"AttemptingSignOut");this.C.g(this.R,this.Q);this.C=null;if(n){var t=this,i=this;_o365sg2p.e.b(!1,function(){},function(n){_j.e.c(_a.a.l,"ChatManager: Failed to set Skype auto-signin preference to false: {0}",n.message)})}},h:function(n,t,i){},m:function(n,t){if(this.C){var i=t!=="Offline"?t:"Hidden";this.C.a().a.b(_sk.d.b(i))}},n:function(n,t){t==="Error";_j.e.a(_a.a.l,"SignInState: {0} Requesting change from {1} to {2}",n,this.B,t);var i=this.c();if(this.B!==t){this.B=t;this.bw(_lwx.b.a);this.c()!==i&&this.bw(_lwx.b.b)}},A:function(n,t){_j.e.a(_a.a.l,"Setting current user SIP URI to {0}",t);this.M=t},x:function(){},u:function(n){return _lwx.c.b(n)},g:function(n){return _lwx.c.c(n)},bx:function(){_j.R.prototype.bx.call(this)},bf:function(){this.n("SignOutSucceeded","SignedOut")},bc:function(n,t,i){if(this.B!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_j.h.a(i)){_j.e.a(_a.a.l,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");this.J.c()||(r="Disabled")}this.n("Configuration Updated",r)}this.Z=t;this.A("InternalSetConfiguration",i);this.L=!0},bd:function(){this.G&&_sk.e.a&&_sk.e.a.k();_sk.c.a.f(this.V)},bj:function(){this.n("SignInFailed","SignedOut")},bg:function(){this.K.a(_db.ct,new _db.ct)},bk:function(n){_sk.c.a.a(6)},ba:function(){this.n("SignInSucceeded","SignedIn");this.G=!1},be:function(n){this.n("SignOutFailed","SignedOut")},X:function(n){this.N&&(this.B==="unknown"||!this.L)&&_j.e.c(_a.a.l,"ChatManager: Do not access {0} until configuration has loaded.",n)},bb:function(n){var t=n.e().bD.InstantMessage;var i=n.c().bD.UserDisplayName;var r=n.c().bD.UserSipUri;this.bc(t,i,r)},z:function(n,t,i){return null},q:function(){return null},a:function(n){return this.c()&&!_j.h.b(n)&&(_j.h.b(this.b())||n.toLowerCase()!==this.b().toLowerCase())},e:function(n){for(var t=0;t<n.b();t++)if(this.a(n.a(t).SipUri))return!0;return!1},y:function(){this.C.a().d()},j:function(n){this.bA(_lwx.b.c,n)},bh:function(n){this.C=n;this.C.f(this.U);_sk.g.b?this.ba():_sk.g.c(this.P);_sk.c.a.d(this.S)},bi:function(n){if(n.b==="UnreadMessage"&&n.a){n.a.play();return}_sk.c.a.a(4);if(n.i()){var f=n.e.a.c.c();var t="IM:"+Math.random().toString();_j.e.a(_a.a.l,"OnSkypeNotification");if(!(t in this.D)){this.D[t]=n;var i=this;var r=function(r){_j.e.a(_a.a.l,"OnSkypeNotification handler");if(!r){for(var u=0;u<i.E.x.length;u++){var f=i.E.x[u];if(f.c().Id===t){i.E.p(f,!0);n.c.d(i.H[t]);delete i.H[t]}}t in i.D&&delete i.D[t]}};this.H[t]=r}this.bl(n.e,n.b,n.f.c(),t,n.a);var u=this.H[t];n.c.a(u)}},bl:function(n,t,i,r,u){var s=new _lwx.i(n);s.hd();var h=new _j.l;h.a(n);var f=new _h.h(!0);f.a().z(h);f.N(new _g.e(r));f.j=s;f.r=i;f.B=t;if(u){var e=u;f.w=e.$$d_play||(e.$$d_play=Function.createDelegate(e,e.play));var o=u;f.z=o.$$d_stop||(o.$$d_stop=Function.createDelegate(o,o.stop))}this.E.a(f)},O:function(n,t){this.E.p(n,!0);if(n.c().Id in this.D){var i=this.D[n.c().Id];if(t===3){i.d(1);_sk.c.a.a(2)}else if(t)t===1&&i.h();else{i.d();_sk.c.a.a(2)}n.j.he();delete this.D[n.c().Id]}},w:function(n){},o:function(n){this.O(n,0)},p:function(n){this.O(n,3)},v:function(n){this.O(n,1)}};_lwx.b.d=function(){};_lwx.b.d.prototype={accept:0,decline:1,open:2,acceptWithIm:3};_lwx.b.d.registerEnum("_lwx.b.d",!1);_lwx.f=function(n,t,i,r){this.j=Function.createDelegate(this,this.o);this.l=new Sys.EventHandlerList;this.f=n;this.k=t;this.h=i;this.g=r;this.h.e(this.j);this.g.e(this.j)};_lwx.f.prototype={k:null,h:null,g:null,f:!1,m:!1,n:0,b:function(n){n&&this.f&&(this.i()?n():this.l.addHandler("chatInitialized",n))},a:function(){return this.i()&&this.f?this.k:null},e:function(){return this.i()&&this.f?this.h.b():null},d:function(){return this.i()&&this.f?this.g.b():null},c:function(){return this.f},i:function(){if(!this.f||this.m)return!0;this.h.a(null);this.g.a(null);return!1},o:function(){this.n++;if(this.n===2){this.m=!0;var n=this.l.getHandler("chatInitialized");n&&n()}}};_lwx.g=function(n,t,i,r,u){this.e=n;this.d=t;this.g=i;this.c=r;this.f=u};_lwx.g.prototype={e:!1,d:null,g:null,c:null,f:0,b:null,a:function(){_a.b.f(this.f,"Mouse","ChatProviderFactory.Create - Layout");this.b||(this.b=new _lwx.f(this.e,this.d,this.g,this.c));return this.b}};_lwx.h=function(n,t){this.j=Function.createDelegate(this,this.m);this.i=Function.createDelegate(this,this.l);this.d={};this.e={};_lwx.h.initializeBase(this);_j.e.a(_a.a.de,"LyncIntegration PresenceManager started");this.f=n;this.f.apcl(_lwx.b.a,this.i);this.g=this.f.d();this.h=t;_sk.a.a(this.j)};_lwx.h.prototype={f:null,h:null,c:null,g:"unknown",l:function(n,t){var u=n;var i=this.g;var f=i==="SignedIn";this.g=u.B;var r=this.f.d()==="SignedIn";if(f!==r&&!r){_j.e.a(_a.a.bI,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",i,this.g);this.D()}},m:function(n){this.c=n;this.n()},n:function(){var n=this.d;for(var t in n){var i={key:t,value:n[t]};this.k(i.key)}},a:function(n){_j.e.a(_a.a.de,"LyncIntegration PresenceManager TryRegisterForPresenceUpdates: {0}",n);if(_j.h.b(n))return null;n=n.toLowerCase();if(!(n in this.d)){this.d[n]=this.h.a(n);this.k(n)}return this.d[n]},k:function(n){if(this.c&&!(n in this.e)){var t=this;var i=function(i){var r=t.d[n];r.b(_lwx.c.a(i))};this.e[n]=i;n!==this.f.b()?this.c.j(n).b.a(this.e[n]):this.c.a().a.a(this.e[n])}},b:function(n,t){t.val=0;return!1},D:function(){this.o();this.c=null},o:function(){if(this.c){var t=this.d;for(var i in t){var n={key:i,value:t[i]};var r=n.value;r.b(0);this.c.j(n.key).b.d(this.e[n.key]);delete this.e[n.key]}}}};_lwx.c=function(){};_lwx.c.b=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"Offline":return 1;case"Online":return 2}return 0};_lwx.c.a=function(n){switch(n){case 5:case 4:return 3;case 2:return 4;case 3:return 6;case 6:return 1;case 1:return 2}return 0};_lwx.c.c=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline"}return"None"};_lwx.j.registerClass("_lwx.j",_a.gb,_sk.m);_lwx.i.registerClass("_lwx.i",_pc.a);_lwx.a.registerClass("_lwx.a",_sk.e);_lwx.d.registerClass("_lwx.d",_a.dk);_lwx.b.registerClass("_lwx.b",_j.R,_h.bd,_j.bs,Sys.IDisposable);_lwx.h.registerClass("_lwx.h",_j.bZ,_h.cw);_lwx.b.a="SignInState";_lwx.b.b="IsSignedIn";_lwx.b.c="Presence";
window.scriptsLoaded['microsoft.owa.core.lyncintegration.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.core.lyncintegration.js'] = (new Date()).getTime();
